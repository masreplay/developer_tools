# Workspace root for developer_tools monorepo (Melos + Pub Workspaces).
# The main package lives at packages/developer_tools.
name: developer_tools_workspace
description: "Monorepo root for developer_tools and related packages."
version: 0.0.0
publish_to: "none"

environment:
  sdk: ^3.7.0

# Unify transitive versions that differ across workspace packages (e.g. alice
# wants package_info_plus ^8, developer_tools_package_info uses ^9).
dependency_overrides:
  package_info_plus: ^9.0.0

# Pub workspace: all packages developed together (Dart 3.6+)
workspace:
  - packages/developer_tools
  - packages/developer_tools_core
  - packages/developer_tools_get
  - packages/developer_tools_riverpod
  - packages/developer_tools_auto_route
  - packages/developer_tools_device_info
  - packages/developer_tools_package_info
  - packages/developer_tools_firebase_messaging
  - packages/developer_tools_shared_preferences
  - packages/developer_tools_local_auth
  - packages/developer_tools_permission_handler
  - packages/developer_tools_alice

dev_dependencies:
  melos: ^7.0.0

melos:
  useRootAsPackage: false
  repository: https://github.com/masreplay/developer_tools
  categories:
    app:
      - "example"
      - "packages/developer_tools_riverpod/example"
    packages:
      - "packages/*"
  ignore:
    - "packages/**/example"
  scripts:
    install:
      run: melos bootstrap
      description: Install dependencies and link workspace packages (runs melos bootstrap)
    clean:
      run: melos clean
      description: Clean build artifacts and caches
    format:
      run: melos format
      description: Format all packages
    analyze:
      run: melos exec -- dart analyze lib test
      description: Analyze all packages
    test:
      run: melos exec -- dart test
      description: Run tests in all packages
    version:
      run: melos version
      description: Version packages from conventional commits and update changelogs
    version:prerelease:
      run: melos version --prerelease
      description: Version packages as prerelease
    version:graduate:
      run: melos version --graduate
      description: Graduate prerelease versions to stable
    publish:dry:
      run: melos exec -- dart pub publish --dry-run
      description: Validate publish (dry run)
    publish:to-pub:
      run: melos publish --no-dry-run -y
      description: Publish packages to pub.dev (run 'melos publish --no-dry-run' directly)
  command:
    version:
      branch: main
      changelog: true
      gitTagVersion: true
      workspaceChangelog: true
      linkToCommits: true
      includeCommitId: false
      includeScopes: true
      message: "chore(release): publish packages\n\n{new_package_versions}"
      changelogFormat:
        includeDate: true
